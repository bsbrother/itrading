# 高级选股器预开盘功能更新

## 📈 更新概述

高级选股器 (AdvancedStockPicker) 现已支持9:30前的预开盘选股功能，与基础选股器保持一致的预开盘体验。

## 🔧 主要更新

### 1. 市场环境分析增强
- **智能开盘检测**: 通过涨幅数据判断市场是否开盘
- **保守模式策略**: 预开盘时自动使用保守的normal模式
- **数据源适配**: 支持qstock和akshare不同的列名格式

### 2. 技术面过滤优化
- **预开盘跳过**: 市场未开盘时跳过技术面过滤
- **开盘后完整**: 开盘后应用完整的技术指标过滤
- **智能提示**: 明确显示过滤状态

### 3. 选股流程适配
- **分级筛选**: 预开盘时只应用基本面筛选
- **容错处理**: 允许预开盘时的空数据情况
- **状态透明**: 清晰显示当前筛选模式

### 4. 显示界面优化
- **预开盘标识**: 明确显示"高级预选"状态
- **待开盘提示**: 交易指标显示"待开盘"
- **风险提示**: 针对预开盘的专门提示

## 🎯 使用效果

### 预开盘（9:30前）
```bash
uv run python advanced_stock_picker.py

# 输出示例：
# 📢 当前为市场开盘前，基于昨日数据进行高级筛选
# 🎯 高级预选 8 只潜力股（待开盘确认）:
#  1. 000319 股票319    价格: 19.86 涨幅:待开盘 换手:待开盘 量比:待开盘 市值:  50.0亿 得分:0.674
# ⚠️ 风险提示: 这是开盘前的高级预选结果，请在开盘后结合实时行情再次确认！
```

### 开盘后（9:30后）
```bash
uv run python advanced_stock_picker.py

# 输出示例：
# 🎯 今日精选 8 只潜力股:
#  1. 600744 华银电力     价格:  7.25 涨幅: 8.21% 换手:14.37% 量比: 9.15 市值: 147.3亿 得分:0.423 风险:0.301
# ⚠️ 风险提示: 投资有风险，交易需谨慎！
```

## 🔄 技术细节

### 预开盘检测逻辑
```python
# 检查涨幅数据是否为空来判断市场状态
valid_gain_data = df_clean[df_clean[gain_col].notna()]
if valid_gain_data.empty:
    # 市场未开盘，返回保守模式
    return 'normal'
```

### 筛选策略调整
```python
if market_open:
    # 完整的技术面+基本面筛选
    selected = apply_full_criteria(df)
else:
    # 仅基本面筛选（市值、价格、PE）
    selected = apply_basic_criteria(df)
```

### 显示逻辑适配
```python
if is_pre_market:
    print("🎯 高级预选 X 只潜力股（待开盘确认）:")
    # 显示"待开盘"而不是具体数值
else:
    print("🎯 今日精选 X 只潜力股:")
    # 显示完整的交易数据和风险评分
```

## 📊 对比分析

| 功能特性 | 基础选股器 | 高级选股器 |
|---------|-----------|-----------|
| 预开盘支持 | ✅ | ✅ |
| 基本面筛选 | ✅ | ✅ |
| 技术面筛选 | ❌ | ✅ (开盘后) |
| 风险评分 | ❌ | ✅ (开盘后) |
| 行业过滤 | ❌ | 🔄 (待完善) |
| 市场模式 | 固定 | 智能调整 |
| 综合得分 | 基础算法 | 风险调整算法 |

## 🚀 使用建议

1. **预开盘使用**: 8:30-9:30期间运行，获取预选股票清单
2. **开盘后确认**: 9:30后重新运行，获取完整分析结果
3. **模式选择**: 让系统自动调整市场模式 (`auto_adjust_mode=True`)
4. **结果对比**: 对比预开盘和开盘后的选股结果

## 🔧 配置参数

高级选股器支持的预开盘相关配置：
- `market_mode`: 市场模式（预开盘时推荐'normal'）
- `auto_adjust_mode`: 自动调整模式（推荐开启）
- `max_stocks`: 选股数量（预开盘时建议适当增加）

现在高级选股器已完全支持全天候选股，可以在9:30前就开始准备选股策略了！
